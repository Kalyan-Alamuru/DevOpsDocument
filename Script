set UVPATH=%~1
set UVFILE=%2
set HEXFILE=%3

set VERSIONSTR=%bamboo_VERSIONBASE%%bamboo_buildNumber%

echo "Delivering project %UVPATH%, %UVFILE%, %HEXFILE%"

mkdir %VERSIONSTR%
mkdir %VERSIONSTR%\%UVFILE%
mkdir %VERSIONSTR%\%UVFILE%\%HEXFILE%

cd "%bamboo_build_working_directory%\%UVPATH%\out\

for %%G in (hex bin axf map) do (
IF EXIST "*.%%G" (
echo "%%G File already exist"
exit 1
) ELSE (
echo "Files Does not exists proceeding with next Steps"
)
)

cd %bamboo_build_working_directory%\automation\Hex2bin-1.0.10\Windows\hex2bin.exe "%bamboo_build_working_directory%\%UVPATH%\out\%HEXFILE%.hex"

copy "%bamboo_build_working_directory%\%UVPATH%\out\%HEXFILE%.hex" %VERSIONSTR%\%UVFILE%\%HEXFILE%\%HEXFILE%.hex
copy "%bamboo_build_working_directory%\%UVPATH%\out\%HEXFILE%.bin" %VERSIONSTR%\%UVFILE%\%HEXFILE%\%HEXFILE%.bin
copy "%bamboo_build_working_directory%\%UVPATH%\out\%HEXFILE%.axf" %VERSIONSTR%\%UVFILE%\%HEXFILE%\%HEXFILE%.axf
copy "%bamboo_build_working_directory%\%UVPATH%\out\%HEXFILE%.map" %VERSIONSTR%\%UVFILE%\%HEXFILE%\%HEXFILE%.map
copy "%bamboo_build_working_directory%\%UVPATH%\*.txt" %VERSIONSTR%\%UVFILE%\%HEXFILE%\

IF "%bamboo_CRCFILE%"=="1" (
        python automation\image_tool.py %VERSIONSTR%\%UVFILE%\%UVFILE%.bin %VERSIONSTR%\%UVFILE%\%UVFILE%_crc.bin
        mv %VERSIONSTR%\%UVFILE%\%UVFILE%_crc.bin %VERSIONSTR%\%UVFILE%\%UVFILE%.bin
)

IF "%bamboo_planRepository_1_branch%"=="SDK3_0_4" (
	call buildtools\images\copy_to_images.bat %VERSIONSTR% "/images/BLE/Builds"
) ELSE (
  echo "skipping copy to images"
)
